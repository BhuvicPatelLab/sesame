---
title: "Working with Mouse (MM285) Array"
package: sesame
output: rmarkdown::html_vignette
fig_width: 8
fig_height: 6
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{5. Mouse Array}
  %\VignetteEncoding{UTF-8}
---

```{r message=FALSE, warning=FALSE, include=FALSE}
library(sesame)
library(dplyr)
options(rmarkdown.html_vignette.check_title = FALSE)
```

SeSAMe provides extensive native support for the Illumina mouse array
(referred to as the MM285 array).
The MM285 contains ~285,000 probes covering over 20 design categories including
gene promoters, enhancers, CpGs in synteny to human EPIC array as well as other
biology. This documents describe the procedure to process the MM285 array.

You can download an example mouse array IDAT
```{r eval=FALSE}
res_grn = sesameDataDownload("204637490002_R05C01_Grn.idat")
res_red = sesameDataDownload("204637490002_R05C01_Red.idat")
pfx = sprintf("%s/204637490002_R05C01", res_red$dest_dir)
```

Load IDAT into `SigSet`
```{r eval=FALSE}
sset = readIDATpair(pfx)
```

or let's consider a pre-built `SigSet` object
```{r include=FALSE}
sset = sesameDataGet('MM285.1.NOD.FrontalLobe')
```

The default openSesame pipeline works for the mouse array
```{r eval=FALSE}
openSesame(idat_dir)
```

Preprocess the sigset to produce beta values.
The standard `noob`, `dyeBiasCorrTypeINorm` works as expected:
```{r}
sset_normalized = sset %>%
                       noob %>%
                       dyeBiasCorrTypeINorm %>%
                       qualityMask %>%
                       detectionMask
```
Retrieve beta values using the following commands
```{r}
betas = sset %>% getBetas
```

By default the repeat and suboptimally designed probes are masked by `NA`.
Starting from mouse array, the suboptimally designed probes take a new
probe ID prefix ("uk") instead of the "cg"/"ch"/"rs" typically seen in
the human array.
```{r}
head(betas[grep('uk', names(betas))])
```

To use the un-masked probes, one should use the resetMask function
```{r}
betas = sset_normalized %>% getBetas(mask=FALSE)
head(betas[grep('uk', names(betas))])
```



